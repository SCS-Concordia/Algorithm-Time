var fs          = require("fs");
var Rx          = require("rx");
var rxDirectory = require("rx-directory");

var readFile = Rx.Observable.fromNodeCallback(fs.readFile);
var statFile = Rx.Observable.fromNodeCallback(fs.stat);

module.exports = function(path) {
    return function() {
        return rxDirectory(path).flatMap(function(file) {
            return statFile(file).flatMap(function(stat) {
                if (stat[0].isDirectory()) {
                    return Rx.Observable.empty();
                } else {
                    return readFile(file).map(function(contents) {
                        return JSON.parse(contents);
                    });
                }
            });
        });
    }
}
