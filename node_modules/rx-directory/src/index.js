var Rx   = require("rx");
var fs   = require("fs");
var path = require("path");

var readDir  = Rx.Observable.fromNodeCallback(fs.readdir);
var statFile = Rx.Observable.fromNodeCallback(fs.stat);

var directory = function(dir) {
    return readDir(dir).flatMap(function(files) {
        return Rx.Observable.fromArray(files).map(function(file) {
            return path.join(dir, file);
        });
    });
};

directory.recursive = function(dir) {
    return directory(dir).flatMap(function(file) {
        return statFile(file).flatMap(function(stat) {
            if (stat.isDirectory()) {
                return directory.recursive(file);
            } else {
                return Rx.Observable.fromArray([file]);
            }
        });
    });
};

module.exports = directory;
